<!DOCTYPE html>
<html>
	<head>
		<!--  
		<meta charset="UTF-8">
		<title>Insert title here</title>
	    <!-- Bootstrap -->
   		<!--  <link href="css/bootstrap.min.css" rel="stylesheet">-->
   		
   		
   		
   		
   		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<meta name="MSSmartTagsPreventParsing" content="TRUE"/>
		<meta http-equiv="cache-control" content="no-cache"/>
		<meta http-equiv="cache-control" content="no-store"/>
		<meta http-equiv="pragma" content="no-cache"/>
		<meta name="robots" content="noindex"/>
		<title>Picture-Community</title>
		
		<!-- Bootstrap -->
		<!-- Bootstrap core CSS -->
		<link href="../../resources/css/bootstrap.min.css" rel="stylesheet">
		<!-- Bootstrap theme -->
		<!--  <link href="../../resources/css/bootstrap-theme.min.css" rel="stylesheet"> -->
		
		<!-- Custom styles for this template -->
		<!-- <link href="theme.css" rel="stylesheet"> -->
		<link href="../../resources/css/default.css" rel="stylesheet">
		
			
		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
		  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
   		
   		
   		
   		
	</head>
	<body>
		<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
			<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="#">Picture-Community</a>
				</div>
				<div id="navbar" class="collapse navbar-collapse">
					<ul class="nav navbar-nav">
						<li><a href="#home">Home</a></li>			
			            <li><a href="#register">Register</a></li>
			            <li><a href="#login">Login</a></li>
			            <li><a href="#logout">Logout</a></li>
					</ul>
				</div><!--/.nav-collapse -->
			</div>
		</nav>
		
		<div id="info" class="container contentPage">
			<div class="row ">
				<div class="alert alert-danger" role="alert">
	
		      	</div>
	      	</div>
      	</div>
      	
		<div id="registerPage" class="container contentPage">
			
			<div class="row ">
	            <div class="col-md-4 "></div>
	            <div class="col-md-4 panel panel-default">
					<!--  <form id="register" method="get" action="#home">-->
						<h2 class="form-signin-heading">Please register</h2>
						
						<label for="r_username" class="sr-only">Username</label>
						<input type="text" id="r_username" name="r_username" class="form-control" placeholder="Username"/>
						
						<label for="r_email" class="sr-only">Email</label>
						<input type="email" id="r_email" name="r_email" class="form-control" placeholder="Email address"/>
						
						<label for="r_password" class="sr-only">Password</label>
						<input type="password" id="r_password" name="r_password" class="form-control" placeholder="Password"/>
						
						
						<button class="btn btn-lg btn-primary btn-block" onClick="tryRegistration();">Register</button>
					<!--</form>-->
					<p> </p><!--to do: fix Layout!!! -->
				</div>
	            <div class="col-md-4"></div>
			</div>
			
   		</div> <!-- /container -->
		
		<div id="loginPage" class="container contentPage">
			
			<div class="row">
	            <div class="col-md-4"></div>
	            <div class="col-md-4 panel panel-default">
					<!--<form id="login" method="get" action="#home"> -->
						<h2 class="form-signin-heading">Please sign in</h2>
						
						<label for="l_username" class="sr-only">Email address</label>
						<input type="text" id="l_username" name="username" class="form-control" placeholder="Username"/>
						
						<label for="l_password" class="sr-only">Password</label>
						<input  type="password" id="l_password" name="password" class="form-control" placeholder="Password"/>
						
						<button class="btn btn-lg btn-primary btn-block" onClick="tryLogin();">Sign in</button>
					 <!--</form> -->
		            <p>Not a member yet? <a href="#register">Register Now!</a></p>
				</div>
	            <div class="col-md-4"></div>
			</div>
			
   		</div> <!-- /container -->
   		
   		
   		<div id="homePage" class="container contentPage">
   			<div class="row ">

	            <div class=" panel panel-default">
	            	<div class="panel-heading">
	            			<h3 >My Pictures</h3>		
					</div>
	            			
					  <div id="gallery" class="row">
					  	<!--  
					    <div class="col-lg-2 col-sm-3 col-xs-4">
					        <a href="#">
					             <img src="http://placehold.it/200x200" class="thumbnail img-responsive">
					        </a>
					        <a href="#edit">edit</a>
					    </div>
				        <div class="col-lg-2 col-sm-3 col-xs-4">
					        <a href="#">
					             <img src="http://placehold.it/200x200" class="thumbnail img-responsive">
					        </a>
					        <a href="#edit">edit</a>
					    </div>
					  </div>
						-->

				</div>

	         </div>   
			</div>
			<div id="uploadPanel" class="row ">

	            <div class="panel panel-default">
	            		<div class="panel-heading">
	            			<h3 class="">Upload Images</h3>		
						</div>
						<div class="panel-body">
							
							 	<label for="u_title" class="sr-only">Title</label>
								<input type="text" id="u_title" name="u_title" class="form-control" placeholder="Title"/>
								
								<label for="u_description" class="sr-only">Description</label>
								<textarea id="u_description" name="u_description" class="form-control " placeholder="Description" rows="3" ></textarea>
								
								<label for="u_file" class="sr-only">Select File</label>
								<!--<input type="file" id="u_file" name="u_file" class="form-control" placeholder="File" multiple="false"/>-->
							<form >	
								<input  id="fileupload" type="file" name="file" multiple="false"/>
							</form>
								<!--  <button id="u_button" class="btn btn-lg btn-primary class="form-control"" onClick="uploadFile()">Upload</button> -->
							
						</div>
				</div>
			</div>
   		</div> <!-- /container -->
   		
   		
   		<div id="imagePage" class="container contentPage">
   			<div class="panel panel-default">
	            		<div class="panel-heading">
	            			<h3 class="">Title</h3>		
						</div>
						<div id="imageContent" class="panel-body">
						      
						      	<div class="caption">
							        <p>...</p>
								</div>
						</div>	
				</div>
   		</div> <!-- /container -->
	
		<script>	
			function tryLogin(){
				login($("#l_username").val() ,$("#l_password").val() );

				//window.location.search = "?"+jQuery.param({username:$("#l_username").val()},true );
				
				window.location.hash = "home";
				locationHashChanged();
				
			}
			
			function tryRegistration(){
				register($("#r_username").val(), $("#r_password").val(), $("#r_email").val())
			}
			
			function loadImagePage(){
				var c = function (data){
					imageId = GetURLParameter("imageId");
					
					if( data.length > 0 && imageId != ""){

						
						$.each(data, function(key, imageObjct) {
	
							if(imageObjct.id == imageId){
								$('#imagePage h3').empty().append(imageObjct.name);
								loadPicture($('#imageContent'),imageObjct.id, -1,"img-responsive"); 
								$('#imagePage p').empty().append(imageObjct.description);
							}
						});
					}
				}
				getPictureInfos("*", c); // fixed because private pictures error (login problems)
			}
			
			
			function loadHomeGallery(name){
				$("#gallery").empty();
				$("#gallery").removeAttr("class");
				$("#gallery").append("<p>Sorry, no pictures available.</p>");
				var c = function (data){
					
					if( data.length > 0){
						$("#gallery").empty();
						$.each(data, function(key, imageObjct) {
	
							var div = document.createElement('div');
							div.setAttribute("class", "col-lg-2 col-sm-3 col-xs-4");
							$(div).append("<a id=\""+imageObjct.id+"\" href=\"?imageId="+imageObjct.id+"#image\">" +"</a>");
							loadPicture($('a:first',div),imageObjct.id, 200,"thumbnail img-responsive"); 
							$(div).appendTo("#gallery");
							$("#gallery").attr("class","panel-body");
						});
					}
				}
				getPictureInfos(name, c);
			}
					
			function locationHashChanged() {
				$(".contentPage").hide();
				
				if(location.hash === "#logout"){
					window.location.search = "";
					logout();
					console.log("loging out");
					$('#info').fadeIn(300);
					$('#info div div').attr("class", "alert alert-warning");
					$('#info div div').empty().append(				
							"<strong>Logged out!</strong> Pfiat di.");
					
				}else if(location.hash === "#login"){
					$("#loginPage").show();
					
				}else if(location.hash === "#register"){
					$("#registerPage").show();
					
				}else if(location.hash === "#home"){
					var user = GetURLParameter("username");
					//if(typeof user === 'undefined'){
						user = "*";
					//}
					loadHomeGallery(user);
					$("#homePage").show();
				}else if(location.hash === "#image"){
					loadImagePage();
					$("#imagePage").show();	
				}else{
					window.location.hash = "register";
				}
			}
			
			window.addEventListener("hashchange", locationHashChanged, false);
			
			window.addEventListener("load", function(){
				//checkAuthorization()
				locationHashChanged();
			});
			
			
			function GetURLParameter(sParam){
				var sPageURL = window.location.search.substring(1);
				var sURLVariables = sPageURL.split('&');
				for (var i = 0; i < sURLVariables.length; i++){
					var sParameterName = sURLVariables[i].split('=');
					if (sParameterName[0] == sParam){
						return sParameterName[1];
					}
				}
			}
			/*
			function uploadFile() {

				
			    $('#u_file').fileupload({url: '/PictureCommunity/REST/newpicture', formData: function(form) {
					return [{ name: 'title', value: $("#u_title")},{ name: 'description', value: $("#u_description")}, { name: 'public', value: true }]; 
				}});
			}
			
			$(function () {
				$('#u_file').fileupload({url: '/PictureCommunity/REST/newpicture', formData: function(form) {
					return [{ name: 'title', value: $("#u_title")},{ name: 'description', value: $("#u_description")}, { name: 'public', value: true }]; 
				}});
			});*/
			
			$(function () {
			    $('#fileupload').fileupload({url: '/PictureCommunity/REST/newpicture', formData: function(form) {
					return [{ name: 'description', value: 'Ein perfektes Bild eines Meisters'}, { name: 'public', value: true }]; 
				}});
			});
			
			</script>
	
	
	
	
	
		<!-- Bootstrap core JavaScript
		================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		<script src="../../resources/js/jquery-2.0.1.js"></script>
		<script src="../../resources/js/bootstrap.min.js"></script>
		<script src="../../resources/js/restConnector.js"></script>
		<!--  <script src="../../assets/js/docs.min.js"></script> -->
		<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
		<!--  <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script> -->
	</body>
</html>